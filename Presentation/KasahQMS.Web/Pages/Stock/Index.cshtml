@page
@model KasahQMS.Web.Pages.Stock.IndexModel
@{
    ViewData["Title"] = "Stock Management";
}

<div class="space-y-6 animate-fade-in">
    <!-- Page Header -->
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div>
            <h1 class="text-2xl lg:text-3xl font-bold text-slate-900 tracking-tight">Stock Management</h1>
            <p class="mt-1 text-slate-500">Track products, services, and inventory levels</p>
        </div>
        @if (Model.CanManageStock)
        {
            <div class="flex flex-wrap gap-3">
                <a href="/Stock/Locations"
                   class="inline-flex items-center gap-2 px-4 py-2.5 bg-white border border-slate-200 text-slate-700 font-semibold rounded-xl hover:bg-slate-50 hover:border-brand-300 transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    Locations
                </a>
                <a href="/Stock/Movements"
                   class="inline-flex items-center gap-2 px-4 py-2.5 bg-white border border-slate-200 text-slate-700 font-semibold rounded-xl hover:bg-slate-50 hover:border-brand-300 transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                    </svg>
                    Movements
                </a>
                <a href="/Stock/Create"
                   class="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-brand-600 to-brand-700 text-white font-semibold rounded-xl hover:from-brand-700 hover:to-brand-800 transition-all shadow-lg shadow-brand-500/25 hover:shadow-brand-500/40 hover:shadow-xl">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add Stock Item
                </a>
            </div>
        }
    </div>

    <!-- Stats Grid -->
    <div class="grid gap-5 sm:grid-cols-2 xl:grid-cols-4">
        <div class="card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-[11px] font-semibold uppercase tracking-wider text-slate-400">Total Items</p>
                    <p class="mt-3 text-3xl font-bold text-slate-900">@Model.Summary.TotalItems</p>
                    <p class="mt-1 text-sm text-slate-500">In catalog</p>
                </div>
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand-100 to-brand-50 flex items-center justify-center">
                    <svg class="w-6 h-6 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-[11px] font-semibold uppercase tracking-wider text-slate-400">Below Minimum</p>
                    <p class="mt-3 text-3xl font-bold @(Model.Summary.BelowMinimumCount > 0 ? "text-red-600" : "text-slate-900")">@Model.Summary.BelowMinimumCount</p>
                    <p class="mt-1 text-sm text-slate-500">Needs attention</p>
                </div>
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br @(Model.Summary.BelowMinimumCount > 0 ? "from-red-100 to-red-50" : "from-slate-100 to-slate-50") flex items-center justify-center">
                    <svg class="w-6 h-6 @(Model.Summary.BelowMinimumCount > 0 ? "text-red-600" : "text-slate-400")" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-[11px] font-semibold uppercase tracking-wider text-slate-400">Reorder Alert</p>
                    <p class="mt-3 text-3xl font-bold @(Model.Summary.AtReorderPointCount > 0 ? "text-amber-600" : "text-slate-900")">@Model.Summary.AtReorderPointCount</p>
                    <p class="mt-1 text-sm text-slate-500">At reorder point</p>
                </div>
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br @(Model.Summary.AtReorderPointCount > 0 ? "from-amber-100 to-amber-50" : "from-slate-100 to-slate-50") flex items-center justify-center">
                    <svg class="w-6 h-6 @(Model.Summary.AtReorderPointCount > 0 ? "text-amber-600" : "text-slate-400")" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-[11px] font-semibold uppercase tracking-wider text-slate-400">Total Value</p>
                    <p class="mt-3 text-3xl font-bold text-slate-900">@Model.Summary.TotalValue.ToString("N0")</p>
                    <p class="mt-1 text-sm text-slate-500">RWF inventory</p>
                </div>
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-100 to-emerald-50 flex items-center justify-center">
                    <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="card p-4">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-slate-700 mb-1">Search</label>
                <input type="search" name="SearchTerm" value="@Model.SearchTerm"
                       placeholder="Search by SKU or name..."
                       class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
            </div>
            <div class="w-40">
                <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
                <select name="Status" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
                    <option value="">All</option>
                    <option value="Active" selected="@(Model.Status == KasahQMS.Domain.Enums.StockItemStatus.Active)">Active</option>
                    <option value="Inactive" selected="@(Model.Status == KasahQMS.Domain.Enums.StockItemStatus.Inactive)">Inactive</option>
                    <option value="Discontinued" selected="@(Model.Status == KasahQMS.Domain.Enums.StockItemStatus.Discontinued)">Discontinued</option>
                </select>
            </div>
            <div class="w-40">
                <label class="block text-sm font-medium text-slate-700 mb-1">Category</label>
                <select name="Category" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
                    <option value="">All</option>
                    <option value="Product">Product</option>
                    <option value="Service">Service</option>
                    <option value="RawMaterial">Raw Material</option>
                    <option value="FinishedGoods">Finished Goods</option>
                    <option value="Consumable">Consumable</option>
                    <option value="Equipment">Equipment</option>
                </select>
            </div>
            <button type="submit"
                    class="px-4 py-2 bg-brand-600 text-white font-medium rounded-lg hover:bg-brand-700 transition-colors">
                Filter
            </button>
        </form>
    </div>

    <!-- Stock Items Table -->
    <div class="card overflow-hidden">
        @if (Model.StockItems.Any())
        {
            <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Item</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Category</th>
                        <th class="px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider">Balance</th>
                        <th class="px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider">Reserved</th>
                        <th class="px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider">Available</th>
                        <th class="px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider">Unit Price</th>
                        <th class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-slate-100">
                    @foreach (var item in Model.StockItems)
                    {
                        <tr class="hover:bg-slate-50 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    @if (item.IsBelowMinimum)
                                    {
                                        <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse" title="Below minimum stock level"></div>
                                    }
                                    else if (item.IsAtReorderPoint)
                                    {
                                        <div class="w-2 h-2 rounded-full bg-amber-500" title="At reorder point"></div>
                                    }
                                    <div>
                                        <div class="text-sm font-medium text-slate-900">@item.Name</div>
                                        <div class="text-sm text-slate-500">@item.SKU</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-700">
                                    @item.Category
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <span class="text-sm font-medium @(item.IsBelowMinimum ? "text-red-600" : "text-slate-900")">
                                    @item.Balance.ToString("N2")
                                </span>
                                <span class="text-sm text-slate-500">@item.UnitOfMeasure</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                @if (item.Reserved > 0)
                                {
                                    <span class="text-sm font-medium text-amber-600">@item.Reserved.ToString("N2")</span>
                                }
                                else
                                {
                                    <span class="text-sm text-slate-400">-</span>
                                }
                            </td>
                            <td class="px-6 py-4 text-right">
                                <span class="text-sm font-medium text-slate-900">@item.Available.ToString("N2")</span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <span class="text-sm text-slate-900">@item.UnitPrice.ToString("N0") RWF</span>
                            </td>
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium @item.StatusClass">
                                    @item.Status
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    <a href="/Stock/Details/@item.Id" class="text-brand-600 hover:text-brand-700 text-sm font-medium">View</a>
                                    @if (Model.CanManageStock)
                                    {
                                        <span class="text-slate-300">|</span>
                                        <a href="/Stock/Movement/@item.Id" class="text-emerald-600 hover:text-emerald-700 text-sm font-medium">Move</a>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="text-center py-12">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center">
                    <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-slate-900 mb-1">No stock items found</h3>
                <p class="text-sm text-slate-500 mb-4">Get started by adding your first stock item.</p>
                @if (Model.CanManageStock)
                {
                    <a href="/Stock/Create" class="inline-flex items-center px-4 py-2 bg-brand-600 text-white font-medium rounded-lg hover:bg-brand-700 transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Add Stock Item
                    </a>
                }
            </div>
        }
    </div>

    @if (!Model.CanManageStock)
    {
        <div class="p-4 rounded-xl bg-blue-50 border border-blue-200">
            <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div>
                    <h4 class="text-sm font-medium text-blue-800">View-Only Access</h4>
                    <p class="text-xs text-blue-700 mt-1">You can view stock levels but cannot create, issue, or adjust stock. Contact your manager if you need stock management access.</p>
                </div>
            </div>
        </div>
    }
</div>
